(()=>{"use strict";var e={m:{},u:e=>e+".main.js"};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var i=n.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.b=document.baseURI||self.location.href;const t=[0,33,67,100,133,167,200,234,267,300,334,367,400,434,467,501,534,567,601,634,667,701,734,767,801,834,868,901,934,968,1001,1034,1068,1101,1134,1168,1201,1235,1268,1301,1335,1368,1401,1435,1468,1502,1535,1568,1602,1635,1668,1702,1735,1768,1802,1835,1869,1902,1935,1969,2002,2035,2069,2102,2135,2169,2202,2236,2269,2302,2336,2369,2402,2436,2469,2503,2536,2569,2603,2636,2669,2703,2736,2769,2803,2836,2870,2903,2936,2970,3003,3036,3070,3103,3136,3170,3203,3237,3270,3303,3337,3370,3403,3437,3470,3504,3537,3570,3604,3637,3670,3704,3737,3770,3804,3837,3871,3904,3937,3971,4004,4037,4071,4104,4137,4171,4204,4238,4271,4304,4338,4371,4404,4438,4471,4505,4538,4571,4605,4638,4671,4705,4738,4771,4805,4838,4872,4905,4938,4972,5005,5038,5072,5105,5138,5172,5205,5239,5272,5305,5339,5372,5405,5439,5472,5506,5539,5572,5606,5639,5672,5706,5739,5772,5806,5839,5873,5906,5939,5973,6006,6039,6073,6106,6139,6173,6206,6240,6273,6306,6340,6373,6406,6440,6473,6507,6540,6573,6607,6640,6673,6707,6740,6773,6807,6840,6874,6907,6940,6974,7007,7040,7074,7107,7140,7174,7207,7241,7274,7307,7341,7374,7407,7441,7474,7508,7541,7574,7608,7641,7674,7708,7741,7774,7808,7841,7875,7908,7941,7975,8008,8041,8075,8108,8141,8175,8208,8242,8275,8308,8342,8375,8408,8442,8475,8509,8542,8575,8609,8642,8675,8709,8742,8775,8809,8842,8876,8909,8942,8976,9009,9042,9076,9109,9142,9176,9209,9243,9276,9309,9343,9376,9409,9443,9476,9510,9543,9576,9610,9643,9676,9710,9743,9776,9810,9843,9877,9910,9943,9977,10010,10043,10077,10110,10143,10177,10210,10244,10277,10310,10344,10377,10410,10444,10477,10511,10544,10577,10611,10644,10677,10711,10744,10777,10811,10844,10878,10911,10944,10978,11011,11044,11078,11111,11144,11178,11211,11245,11278,11311,11345,11378,11411,11445,11478,11512,11545,11578,11612,11645,11678],n=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];function i(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(t);let i=0;return e.forEach((e=>{n.set(e,i),i+=e.byteLength})),n}var o=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function c(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}a((i=i.apply(e,t||[])).next())}))};document.title="webcodecs-worker-ts";const r=document.createElement("div");r.style.width="426px",r.style.height="242px",r.style.border="1px solid yellowgreen",document.body.append(r);const c=document.createElement("canvas");c.width=426,c.height=242;const s=c.getContext("2d");r.appendChild(c);const a=document.createElement("div");let d;a.style.width="600px",a.style.border="1px solid yellowgreen",r.appendChild(a);let l,u,p=!0;const h={codedHeight:0,codedRect:null,codedWidth:0,colorSpace:{primaries:null,transfer:null,matrix:null,fullRange:null},displayHeight:0,displayWidth:0,duration:null,format:null,timestamp:null,visibleRect:null},f=Object.keys(h);function y(){return o(this,void 0,void 0,(function*(){d||(yield new Promise((e=>{fetch("./test.h264").then((e=>e.arrayBuffer())).then((t=>{d=new Uint8Array(t),e("")}))})));const e=()=>{const e=d.findIndex(((e,t)=>0===d[t]&&0===d[t+1]&&0===d[t+2]&&1===d[t+3]&&0!==t)),t=d.slice(0,e);return d=d.slice(e),t};return p?(l=e(),u=e(),p=!1,{data:i(l,u,e()),timestamp:t.shift(),type:n.shift()?"key":"delta"}):{data:e(),timestamp:t.shift(),type:n.shift()?"key":"delta"}}))}function m(){return o(this,void 0,void 0,(function*(){return new Promise((e=>{setTimeout(e,33)}))}))}f.forEach((e=>{const t=document.createElement("div");t.id="stas_"+e,"object"==typeof h[e]?t.innerHTML=e+":"+JSON.stringify(h[e]):t.innerHTML=e+":"+h[e],a.appendChild(t)})),function(){o(this,void 0,void 0,(function*(){const n=new Worker(new URL(e.p+e.u(859),e.b));for(n.postMessage({id:"test",requestType:"webcodecs",init:{type:"video",initConfig:{codec:"avc1.42002a"}}}),n.addEventListener("message",(e=>{const{type:t,data:n}=e.data;var i;"video_frame"===t&&(i=n,f.forEach((e=>{i[e]!=h[e]&&(h[e]=i[e],"object"==typeof h[e]?document.getElementById("stas_"+e).innerHTML=e+":"+JSON.stringify(i[e]):document.getElementById("stas_"+e).innerHTML=e+":"+i[e])})),s.drawImage(i,0,0),i.close())}));t.length>0;){const e=yield y();n.postMessage({id:"test",requestType:"webcodecs",addChunk:{type:"video",data:e}},[e.data.buffer]),yield m()}}))}()})();